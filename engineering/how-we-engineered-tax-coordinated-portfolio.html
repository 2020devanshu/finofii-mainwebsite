<!doctype html><html lang="en">
<!-- Mirrored from www.betterment.com/engineering/how-we-engineered-tax-coordinated-portfolio by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 30 Sep 2022 12:44:59 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head data-ipt="How We Engineered Betterment’s Tax-Coordinated Portfolio™">
    <meta charset="utf-8">
    <title>How We Engineered Betterment’s Tax-Coordinated Portfolio™</title>
    <link rel="shortcut icon" href="../hubfs/Graphics/shared-assets/Favicon-navy-circle.png">
    <meta name="description" content="For Tax-Coordinated Portfolio, Betterment’s solver-based portfolio management system enabled us to manage and test our most complex algorithms.">
    
    
    

    <script>
      window.TT = "ewogICAgInNwbGl0cyI6e30sCiAgICAiZXhwZXJpZW5jZVNhbXBsaW5nV2VpZ2h0IjoxMDAsCiAgICAidXJsIjoiaHR0cHM6XC9cL3R0LmJldHRlcm1lbnQuY29tIiwKICAgICJjb29raWVEb21haW4iOiIuYmV0dGVybWVudC5jb20iLAogICAgImVuY29kZWRBdCI6IjIwMjEwNzEzMTU1MjAxIgp9"
    </script>
    
    
    
    <meta property="og:description" content="For Tax-Coordinated Portfolio, Betterment’s solver-based portfolio management system enabled us to manage and test our most complex algorithms.">
    <meta property="og:title" content="How We Engineered Betterment’s Tax-Coordinated Portfolio™">
    <meta name="twitter:description" content="For Tax-Coordinated Portfolio, Betterment’s solver-based portfolio management system enabled us to manage and test our most complex algorithms.">
    <meta name="twitter:title" content="How We Engineered Betterment’s Tax-Coordinated Portfolio™">

    

    
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "NewsArticle",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://www.betterment.com/engineering/how-we-engineered-tax-coordinated-portfolio"
      },
      "headline": "How We Engineered Betterment’s Tax-Coordinated Portfolio™",
      "image": ["https://resources.betterment.com/hubfs/Graphics/Featured-images/betterment-mobile-illustration-with-floating-parts.jpg"],
      "datePublished": "Sep. 27, 2016",
      "dateModified": "Sep 27, 2016 12:00:00 AM",
      "author": {
          "@type": "Person",
          "name": "Erick Gonzalez",
          "url": "www.betterment.com/engineering/author/erick-gonzalez"
      },
      "publisher": {
        "@type": "Organization",
        "name": "Betterment",
        "logo": {
          "@type": "ImageObject",
          "url": "https://www.betterment.com/hubfs/Graphics/shared-assets/betterment-logo.png"
        }
      }
    }
  </script>
  
    <style>
a.cta_button{-moz-box-sizing:content-box !important;-webkit-box-sizing:content-box !important;box-sizing:content-box !important;vertical-align:middle}.hs-breadcrumb-menu{list-style-type:none;margin:0px 0px 0px 0px;padding:0px 0px 0px 0px}.hs-breadcrumb-menu-item{float:left;padding:10px 0px 10px 10px}.hs-breadcrumb-menu-divider:before{content:'›';padding-left:10px}.hs-featured-image-link{border:0}.hs-featured-image{float:right;margin:0 0 20px 20px;max-width:50%}@media (max-width: 568px){.hs-featured-image{float:none;margin:0;width:100%;max-width:100%}}.hs-screen-reader-text{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px}
</style>

<link rel="stylesheet" href="../hs-fs/hub/5274572/hub_generated/template_assets/49667076004/1664300040824/betterment-theme/css/main.min.css">
<link rel="stylesheet" href="../hs-fs/hub/5274572/hub_generated/template_assets/54140855578/1662668619796/betterment-theme/js/custom-scripts/navigation.min.css">
<link rel="stylesheet" href="../hs-fs/hub/5274572/hub_generated/module_assets/64614019605/1664467641345/module_64614019605_toast_banner_global.min.css">
<link rel="stylesheet" href="../hs-fs/hub/5274572/hub_generated/template_assets/57078106260/1657573877356/betterment-theme/templates/engineering_blog/blog.min.css">
<link rel="stylesheet" href="../hs-fs/hub/5274572/hub_generated/module_assets/55330962055/1664467632871/module_55330962055_blog_post_banner_cta.min.css">
<link rel="stylesheet" href="../hs-fs/hub/5274572/hub_generated/module_assets/53653099091/1664467639907/module_53653099091_social_share.min.css">
<link rel="stylesheet" href="../hs-fs/hub/5274572/hub_generated/module_assets/57076926612/1664467644356/module_57076926612_post_bottom_section.min.css">
<link rel="stylesheet" href="../hs-fs/hub/5274572/hub_generated/module_assets/53648998413/1664467636015/module_53648998413_footer_disclosures.min.css">
<link rel="stylesheet" href="../hs-fs/hub/5274572/hub_generated/template_assets/54140855579/1645062324227/betterment-theme/js/custom-scripts/footer.min.css">
    

    
<!--  Added by GoogleAnalytics integration -->
<script>
var _hsp = window._hsp = window._hsp || [];
_hsp.push(['addPrivacyConsentListener', function(consent) { if (consent.allowed || (consent.categories && consent.categories.analytics)) {
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','../../www.google-analytics.com/analytics.js','ga');
  ga('create','UA-10133968-1','auto');
  ga('send','pageview');
}}]);
</script>

<!-- /Added by GoogleAnalytics integration -->

<!--  Added by GoogleTagManager integration -->
<script>
var _hsp = window._hsp = window._hsp || [];

var hsLoadGtm = function loadGtm() {
    if(window._hsGtmLoadOnce) {
      return;
    }

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '../../www.googletagmanager.com/gtm5445.html?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5RSQL7');

    window._hsGtmLoadOnce = true;
};

var useGoogleConsentMode = true;

if (!useGoogleConsentMode){
    _hsp.push(['addPrivacyConsentListener', function(consent){
      if(consent.allowed || (consent.categories && consent.categories.analytics)){
        hsLoadGtm();
      }
  }]);
} else{
    if(!window._hsGoogleConsentRunOnce){
      window._hsGoogleConsentRunOnce=true;

      window.dataLayer=window.dataLayer||[];
      function gtag(){dataLayer.push(arguments);}

      gtag('consent','default',{
        'ad_storage':'denied',
        'analytics_storage':'denied'
      });

      gtag('set','developer_id.dZTQ1Zm',true);

      _hsp.push(['addPrivacyConsentListener',function(consent){
      var hasAnalyticsConsent=consent&&(consent.allowed||(consent.categories&&consent.categories.analytics));
      var hasAdsConsent=consent&&(consent.allowed||(consent.categories&&consent.categories.advertisement));

      gtag('consent','update',{
        'ad_storage':hasAdsConsent?'granted':'denied',
        'analytics_storage':hasAnalyticsConsent?'granted':'denied'
      });
    }]);
  }

  hsLoadGtm();
}
</script>

<!-- /Added by GoogleTagManager integration -->


<meta name="viewport" content="width=device-width, initial-scale=1">

<meta property="og:image" content="https://www.betterment.com/hubfs/Graphics/Featured-images/betterment-mobile-illustration-with-floating-parts.jpg#keepProtocol">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="600">
<meta property="og:image:alt" content="betterment mobile illustration with floating parts">
<meta name="twitter:image" content="https://www.betterment.com/hubfs/Graphics/Featured-images/betterment-mobile-illustration-with-floating-parts.jpg#keepProtocol">
<meta name="twitter:image:alt" content="betterment mobile illustration with floating parts">

<meta property="og:url" content="https://www.betterment.com/engineering/how-we-engineered-tax-coordinated-portfolio">
<meta name="twitter:card" content="summary_large_image">

<link rel="canonical" href="how-we-engineered-tax-coordinated-portfolio.html">

<meta property="og:type" content="article">
<link rel="alternate" type="application/rss+xml" href="rss.xml">
<meta name="twitter:domain" content="www.betterment.com">
<script src="../../platform.linkedin.com/in.js" type="text/javascript">
    lang: en_US
</script>

<meta http-equiv="content-language" content="en">






    
      
            
  <meta name="generator" content="HubSpot"></head>

  
  
    
    
    
  

  <body class="engineering_blog blog_post" data-contentid="57406541360" data-contentabid="">
<!--  Added by GoogleTagManager integration -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5RSQL7" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<!-- /Added by GoogleTagManager integration -->

    
    
    
    
    

    <div class="body-wrapper   hs-content-id-57406541360 hs-blog-post hs-blog-id-57138234906"> 
      
  


      

      
  
  
  <div class="bt-CourtesyNav bt-section bg-grey90 white">
    <div class="bt-container">
      <a href="#main-content" class="header__skip" data-interaction-listener-registered="true">Skip to main content</a>
      <div class="flex-wrap flex-middle u-flexJustifyEnd">
        
  
  
  <nav class="bt-CourtesyNav-list" data-behavior-large-screen-nav="" aria-label="courtesy navigation">
    <ul class="flex-wrap flex-middle u-flexJustifyEnd">
      
        
          <li id="menu-item-Individuals">
            <a href="../index.html" data-event="Individuals" data-track-event="ElementClicked" data-track-name="Individuals" data-track-module="CourtesyNav">Individuals</a>
          </li>
        
      
        
          <li id="menu-item-Employers">
            <a href="../work.html" data-event="Employers" data-track-event="ElementClicked" data-track-name="Employers" data-track-module="CourtesyNav">Employers</a>
          </li>
        
      
        
          <li id="menu-item-Advisors">
            <a href="../advisors.html" data-event="Advisors" data-track-event="ElementClicked" data-track-name="Advisors" data-track-module="CourtesyNav">Advisors</a>
          </li>
        
      
    </ul>
  </nav>

      </div>
    </div>
  </div>

  <div class="nav-header-wrap">
    <div class="nav-header-wrap-children">
      <div id="hs_cos_wrapper_module_1633637126" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module">

<div class="bt-Nav-wrap careers-nav">
      
  

  
  
  
    
    
  
    
    
      
      
      
      
    
  
    
    
      
      
      
      
    
  
    
    
      
      
        
            
          
            
            
          
        
        
            
          
            
            
          
        
        
      
      
      
    
  
    
    
  
    
    
  
  
  <header>
    <div class="bt-Nav bt-section ptb0  ">
      <div class="bt-container">
        <div class="flex-wrap flex-middle">
    
          
          <a href="../index.html" class="bt-Nav-logoContainer" data-track-event="ElementClicked" data-track-name="Logo" data-track-module="TopNav" data-interaction-listener-registered="true">
            <span class="bt-Logo"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 538 74" aria-label="Betterment Logo" role="img" ">
  <title>Betterment Logo</title>
  <path d="M489.013 23.5871C486.234 23.5506 483.488 24.2211 481.019 25.5394C478.55 26.8577 476.432 28.7834 474.853 31.1468V24.8723H463.886V67.4286H474.853V46.5996C474.853 38.5952 478.533 33.8193 484.696 33.8193C490.128 33.8193 494.015 37.5369 494.015 43.7491V67.4286H504.9V41.3701C504.904 30.2529 498.409 23.5871 489.013 23.5871Z" />
  <path d="M380.618 67.3975H369.05V43.7204C369.05 37.8734 365.39 33.7916 360.139 33.7916C353.585 33.7916 349.674 38.567 349.674 46.5705V67.3975H338.014V24.8588H349.674V31.146C351.351 28.7827 353.6 26.857 356.224 25.5387C358.848 24.2204 361.765 23.5502 364.718 23.5872C371.405 23.5872 376.451 26.9308 378.925 32.5689C380.68 29.7955 383.143 27.5108 386.075 25.9369C389.007 24.363 392.308 23.5535 395.657 23.5872C405.318 23.5872 411.557 30.5636 411.557 41.3727V67.4286H399.994V43.7515C399.994 37.9045 396.334 33.8228 391.079 33.8228C384.529 33.8228 380.613 38.5982 380.613 46.6017L380.618 67.3975Z" />
  <path d="M143.033 38.7458L140.543 37.7475L142.924 36.5319C143.203 36.3899 149.575 32.9826 149.575 24.7837C149.575 17.8626 143.423 10.8571 131.662 10.8571H103.243V67.4286H131.717C150.386 67.4286 151.329 54.6111 151.329 52.0423C151.333 42.193 143.116 38.7857 143.033 38.7458ZM114.999 20.1652H129.048C132.903 20.1652 137.055 22.4145 137.055 27.3614C137.055 32.1884 133.026 34.7173 129.048 34.7173H114.999V20.1652ZM130.888 58.1205H114.999V43.5684H130.888C136.093 43.5684 138.813 47.2685 138.813 50.9287C138.813 55.1036 135.48 58.1294 130.888 58.1294V58.1205Z" />
  <path d="M199.414 46.2299C199.161 32.9014 189.991 23.5857 177.106 23.5857C164.026 23.5857 154.159 33.3165 154.159 46.221C154.082 52.127 156.323 57.8338 160.414 62.1474C164.596 66.4726 170.593 68.8429 177.115 68.8429C183.637 68.8429 189.634 66.4637 193.816 62.1474C196.063 59.8026 197.763 57.0007 198.794 53.9387H188.226C186.063 57.7372 181.985 60.0405 177.115 60.0405C171.507 60.0405 166.981 56.108 165.737 50.024L165.433 48.551H199.414V46.2299ZM166.053 40.7887C166.727 38.4138 168.174 36.3234 170.171 34.84C172.169 33.3565 174.605 32.5624 177.106 32.58C182.379 32.58 186.321 35.651 187.697 40.7887H166.053Z" />
  <path d="M304.071 46.2299C303.826 32.9014 294.944 23.5857 282.462 23.5857C269.788 23.5857 260.23 33.3165 260.23 46.221C260.158 52.1266 262.328 57.8325 266.289 62.1474C270.34 66.4726 276.149 68.8429 282.471 68.8429C288.793 68.8429 294.597 66.4637 298.648 62.1474C300.825 59.8026 302.472 57.0007 303.471 53.9387H293.221C291.125 57.7372 287.171 60.0405 282.458 60.0405C277.026 60.0405 272.642 56.108 271.436 50.024L271.142 48.551H304.058L304.071 46.2299ZM271.752 40.7887C272.405 38.4135 273.807 36.323 275.743 34.8395C277.679 33.3561 280.04 32.5621 282.462 32.58C287.57 32.58 291.388 35.651 292.721 40.7887H271.752Z" />
  <path d="M458.229 46.2299C457.983 32.9014 449.1 23.5857 436.617 23.5857C423.941 23.5857 414.388 33.3165 414.388 46.221C414.313 52.126 416.482 57.8321 420.443 62.1474C424.498 66.4726 430.308 68.8429 436.626 68.8429C442.944 68.8429 448.754 66.4637 452.805 62.1474C454.982 59.8026 456.629 57.0007 457.628 53.9387H447.377C445.281 57.7372 441.331 60.0405 436.613 60.0405C431.18 60.0405 426.796 56.108 425.59 50.024L425.296 48.551H458.229V46.2299ZM425.91 40.7887C426.562 38.4135 427.964 36.3226 429.899 34.839C431.834 33.3555 434.195 32.5616 436.617 32.58C441.725 32.58 445.544 35.651 446.877 40.7887H425.91Z" />
  <path d="M335.186 23.6276C327.992 23.1829 321.875 26.296 318.779 32.193V24.8684H306.9V67.4286H318.779V48.9503C318.779 37.6632 326.892 31.9039 335.186 35.1371V23.6276Z" />
  <path d="M258.883 58.1735C257.211 58.9069 255.405 59.2878 253.578 59.2922C248.532 59.2922 245.75 56.2304 245.75 50.6685V33.6217H259.383V24.9268H245.741V6.61875L234.363 10.75V24.9268H215.035V6.61429L203.657 10.7456V52.1927C203.657 63.0848 209.315 68.8429 220.015 68.8429C224.19 68.8429 227.771 68.1699 230.929 66.7839L228.169 58.1825C226.496 58.9159 224.69 59.2967 222.864 59.3011C217.818 59.3011 215.035 56.2394 215.035 50.6774V33.6351H234.371V52.1927C234.371 63.0848 240.029 68.8429 250.733 68.8429C254.904 68.8429 258.486 68.1699 261.643 66.7839L258.883 58.1735Z" />
  <path d="M534.709 58.1691C533.063 58.9024 531.285 59.2832 529.486 59.2877C524.51 59.2877 521.773 56.226 521.773 50.6641V33.6173H535.202V24.9223H521.769V6.61429L510.557 10.7456V52.1927C510.557 63.0848 516.132 68.8429 526.679 68.8429C530.793 68.8429 534.322 68.1699 537.429 66.7839L534.709 58.1691Z" />
  <path d="M45.2571 60.232L81.2004 73.0857C87.0869 65.5936 90.5143 56.0542 90.5143 45.4144C90.5143 20.071 71.061 0.957146 45.2571 0.957146C19.4533 0.957146 0 20.071 0 45.4144C0 56.0542 3.43189 65.5805 9.31831 73.0857L45.2571 60.232Z" fill="#FFC729" />
</svg></span>
          </a>
    
          
          <div class="bt-Nav-triggerCta" data-behavior-toggle-class="is-expanded" data-toggle-target=".bt-OverlayPanel" data-behavior-overlay-nav-trigger="" role="button" tabindex="0" data-cy-overlaynavcta="">
            <span class="">
              <span class="bt-Icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 16 16" aria-label="Open menu" role="img">
                  <title>Open menu</title>
                  <path id="for-open" d="M0 9V7h16v2H0zm0-4V3h16v2H0zm0 8v-2h16v2H0z"></path>
                  <path id="for-close" d="M14.6 0L8 6.6 1.4 0 0 1.4 6.6 8 0 14.6 1.4 16 8 9.4l6.6 6.6 1.4-1.4L9.4 8 16 1.4 14.6 0z"></path>
                </svg>
              </span>
            </span>
          </div>
    
          <div class="nav-wrap flex-wrap flex-middle">
            
            <nav class="HeaderNavWp__nav" data-behavior-large-screen-nav="" aria-label="header navigation">
              <div class="menu-new_menu-container">
                <ul class="menu flex-wrap flex-middle">
                
                  <li id="menu-item-27c7b8732d1a279720d27cc8c3a26c93" class="menu-item menu-item_depth-1   menu-item-27c7b8732d1a279720d27cc8c3a26c93">
                    
                      <a href="../careers.html" data-event="Careers" data-track-event="ElementClicked" data-track-name="Careers
" data-track-module="TopNav">Careers</a>
                    
                    
                    
                    
    
                  </li>
                
                  <li id="menu-item-ab0268fb8036a892dc341945cb7ae3be" class="menu-item menu-item_depth-1   menu-item-ab0268fb8036a892dc341945cb7ae3be">
                    
                      <a href="../careers/engineering.html" data-event="Engineering" data-track-event="ElementClicked" data-track-name="Engineering
" data-track-module="TopNav">Engineering</a>
                    
                    
                    
                    
    
                  </li>
                
                  <li id="menu-item-d6b9ea32b921a9f56de32062ba4b94f3" class="menu-item menu-item_depth-1 current-menu-ancestor current-menu-parent menu-item-has-children menu-item-d6b9ea32b921a9f56de32062ba4b94f3">
                    
                      <a data-event="Blogs" data-track-event="ElementClicked" data-track-name="Blogs
" data-track-module="TopNav" role="button" tabindex="0" aria-controls="menu-control-2" aria-expanded="false">Blogs</a>
                    
                    
                    
                    
                    <ul class="sub-menu" id="menu-control-2">
                      
                      <li id="menu-item-6ee2fe1fca2b4136a53b06e70b70a361" class="menu-item menu-item_depth-2  menu-item-6ee2fe1fca2b4136a53b06e70b70a361">
                        <a href="../design.html" data-event="Product and design blog" data-track-event="ElementClicked" data-track-name="ProductAndDesignBlog
" data-track-module="TopNav" data-itemindex="0">Product and design blog</a>
                      </li>
                      
                      <li id="menu-item-3d3a360f13403f3fbacdfc8d597e8f62" class="menu-item menu-item_depth-2 current-menu-ancestor current-menu-parent menu-item-3d3a360f13403f3fbacdfc8d597e8f62">
                        <a href="../engineering.html" data-event="Engineering blog" data-track-event="ElementClicked" data-track-name="EngineeringBlog
" data-track-module="TopNav" data-itemindex="1">Engineering blog</a>
                      </li>
                      
                    </ul>
                    
    
                  </li>
                
                </ul>
              </div>
            </nav>
            
   
  
      
  
  
  <div class="bt-Nav-panelTrigger bt-nav-cta-1">
    <div class="u-displayNone--until-lg">
      <div>
        <a href="../about.html" class="HeaderNavWp__LoginButton" data-cy-nav-large-secondary-cta="" data-track-event="ElementClicked" data-track-name="LogIn" data-track-module="TopNav" data-interaction-listener-registered="true">
          About us
        </a>
      </div>
    </div>
  </div>
  



  
      
  
  
  <div class="u-displayNone--until-lg bt-nav-cta-2">
    <div>
      <a href="../careers/current-openings.html" class="bt-PrimaryButton" data-cy-nav-large-primary-cta="" data-behavior-get-started-click="" data-get-started-click-location="TopNav">
          Explore openings
      </a>
    </div>      
  </div>
   


            
  
  
  <nav class="bt-CourtesyNav-list" data-behavior-large-screen-nav="" aria-label="courtesy navigation mobile">
    <ul>
      
        
          <li id="menu-item-Individuals">
            <a href="../index.html" data-event="Individuals" data-track-event="ElementClicked" data-track-name="Individuals" data-track-module="CourtesyNav" class="bt-eyebrow">For Individuals</a>
          </li>
        
      
        
          <li id="menu-item-Employers">
            <a href="../work.html" data-event="Employers" data-track-event="ElementClicked" data-track-name="Employers" data-track-module="CourtesyNav" class="bt-eyebrow">For Employers</a>
          </li>
        
      
        
          <li id="menu-item-Advisors">
            <a href="../advisors.html" data-event="Advisors" data-track-event="ElementClicked" data-track-name="Advisors" data-track-module="CourtesyNav" class="bt-eyebrow">For Advisors</a>
          </li>
        
      
    </ul>
  </nav>

          </div>
    
        </div>
      </div>
    </div>
  </header>

  
 
</div>

</div>
      
      <div id="hs_cos_wrapper_module_16419355051849" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module">





   
      
   
      
      <script id="hero-spacing-script" type="application/json">{"pt_lg":120,"pt_sm":100}</script>
   





   

   

   

</div>
    </div>
  </div>

  
      
 

                  








<main id="main-content" class="body-container-wrapper read-time blog-post">
  <div class="body-container body-container--blog-post">
    
    <article>
      <div class="bt-section hero-spacer">
        <div class="see-all-articles">
          <div class="bt-container">
            <a href="../engineering.html" class="bt-TertiaryButton bt-TertiaryButton_reverse">See all articles</a>
          </div>
        </div>
        <div class="bt-container bt-container_small">
          <div class="blog-post-header">
            <h1 class="bt-title2">How We Engineered Betterment’s Tax-Coordinated Portfolio™</h1>

            
            <h2 class="bt-body1">For our latest tax-efficiency feature, Tax Coordination, Betterment’s solver-based portfolio management system enabled us to manage and test our most complex algorithms.</h2>
            
            

            <div class="blog-post-meta flex flex-middle">
            
              <img class="author-thumbnail" src="../hubfs/Graphics/author-avatars/erik-gonzalez.jpg" alt="Image of Erick Gonzalez | Former Lead Software Engineer, Betterment">
            

              <div class="blog-post-meta-text bt-body3">
                <span class="blog-post-meta-text-top">
                  By
                  
                    <a href="author/erick-gonzalez.html" rel="author">Erick Gonzalez</a>
                  
                </span>
                <div class="blog-post-meta-text-bottom">
                  
                    <span>Former Lead Software Engineer, Betterment</span>
                  
                  
                    <span> | </span>
                  
                  
   
     
   
 
   
 
   <div class="blog-post-date">
     <span>Published <time datetime="2016-09-27" class="blog-post-timestamp">Sep. 27, 2016</time> </span>
 
     
   </div>

                </div>
              </div>
            </div>
          </div>
        </div>

        
          <div class="bt-container bt-container_narrow center">
            <img class="blog-post-featured-image" src="../hubfs/Graphics/Featured-images/betterment-mobile-illustration-with-floating-parts.jpg" alt="betterment mobile illustration with floating parts">      
          </div>
        

        <div class="bt-container bt-container_small">
          <div class="blog-post-caption-area">
            <div class="flex flex-spaceBetween blog-post-meta-2">
              <div class="js-post-body-count" aria-hidden="true" hidden>
              How We Engineered Betterment’s Tax-Coordinated Portfolio™ Sep 27, 2016 12:00:00 AM For our latest tax-efficiency feature, Tax Coordination, Betterment’s solver-based portfolio management system enabled us to manage and test our most complex algorithms. Tax efficiency is a key consideration of Betterment’s portfolio management philosophy. With our new Tax Coordination feature, we’re continuing the mission to help our customers’ portfolios become as tax efficient as possible. While new products can often be achieved using our existing engineering abstractions, TCP brought the engineering team a new level of complexity that required us to rethink how parts of our portfolio management system were built. Here’s how we did it. A Primer on Tax Coordination Betterment’s TCP feature is our very own, fully automated version of an investment strategy known as asset location. If you’re not familiar with asset location, it is a strategy designed to optimize after-tax returns by placing tax-inefficient securities into more tax-advantaged accounts, such as 401(k)s and Individual Retirement Accounts (IRAs). Before we built TCP, Betterment customers had each account managed as a separate, standalone portfolio. For example, customers could set up a Roth IRA with a portfolio of 90% stocks and 10% bonds to save for retirement. Separately, they could set up a taxable retirement account invested likewise in 90% stocks and 10% bonds. Now, Betterment customers can turn on TCP in their accounts, and their holdings in multiple investment accounts will be managed as a single portfolio allocation, but rearranged in such a way that the holdings across those accounts seek to maximize the overall portfolio’s after-tax returns. To illustrate, let’s suppose you’re a Betterment customer with three different accounts: a Roth IRA, a traditional IRA, and a taxable retirement account. Let’s say that each account holds $50,000, for a total of $150,000 in investments. Now assume that the $50,000 in each account is invested into a portfolio of 70% stocks and 30% bonds. For reference, consider the diagram. The circles represent various asset classes, and the bar shows the allocation for all the accounts, if added together. Each account has a 70/30 allocation, and the accounts will add up to 70/30 in the aggregate, but we can do better when it comes to maximizing after-tax returns. We can maintain the aggregate 70/30 asset allocation, but use the available balances of $50,000 each, to rearrange the securities in such a way that places the most tax-efficient holdings into a taxable account, and the most tax-inefficient ones into IRAs. Here’s a simple animation solely for illustrative purposes: Asset Location&nbsp;in Action The result is the same 70/30 allocation overall, except TCP has now redistributed the assets unevenly, to reduce future taxes. How We Modeled the Problem The fundamental questions the engineering team tried to answer were: How do we get our customers to this optimal state, and how do we maintain it in the presence of daily account activity? We could have attempted to construct a procedural-style heuristic solution to this, but the complexity of the problem led us to believe this approach would be hard to implement and challenging to maintain. Instead, we opted to model our problem as a linear program. This made the problem provably solvable and quick to compute—on the order of milliseconds per customer. Let’s consider a hypothetical customer account example. Meet Joe Joe is a hypothetical Betterment customer. When he signed up for Betterment, he opened a Roth IRA account. As an avid saver, Joe quickly reached his annual Roth IRA contribution limit of $5,500. Wanting to save more for his retirement, he decided to open up a Betterment taxable account, which he funded with an additional $11,000. Note that the contribution limits mentioned in this example are as of the time this article was published. Limits are subject to change from year to year, so please defer to IRS guidelines for current limits.&nbsp;See IRA limits here and 401(k) limits. Joe isn’t one to take huge risks, so he opted for a moderate asset allocation of 50% stocks and 50% bonds in both his Roth IRA and taxable accounts. To make things simple, let’s assume that both portfolios are only invested in two asset classes: U.S. total market stocks and emerging markets bonds. In his taxable account, Joe holds $5,500 worth of U.S. total market stocks in VTI (Vanguard Total Stock Market ETF), and $5,500 worth of emerging markets bonds in VWOB (Vanguard Emerging Markets Bond ETF). Let’s say that his Roth IRA holds $2,750 of VTI, and $2,750 of VWOB. Below is a table summarizing Joe’s holdings: Account Type: VTI (U.S. Total Market) VWOB (Emerging Markets Bonds) Account Total Taxable $5,500 $5,500 $11,000 Roth $2,750 $2,750 $5,500 Asset Class Total $8,250 $8,250 $16,500 To begin to construct our model for an optimal asset location strategy, we need to consider the relative value of each fund in both accounts. A number of factors are used to determine this, but most importantly each fund’s tax efficiency and expected returns. Let’s assume we already know that VTI has a higher expected value in Joe’s taxable account, and that VWOB has a higher expected value in his Roth IRA. To be more concrete about this, let’s define some variables. &nbsp; Each variable represents the expected value of holding a particular fund in a particular account. For example, we’re representing the expected value of holding VTI in your Taxable as which we’ve defined to be 0.07. More generally, Let’s let be the expected value of holding fund F in account A. Circling back to the original problem, we want to rearrange the holdings in Joe’s accounts in a way that’s maximally valuable in the future. Linear programs try to optimize the value of an objective function. In this example, we want to maximize the expected value of the holdings in Joe’s accounts. The overall value of Joe’s holdings are a function of the specific funds in which he has investments. Let’s define that objective function. &nbsp; You’ll notice the familiar terms—measuring the expected value of holding each fund in each account, but also you’ll notice variables of the form Precisely, this variable represents the balance of fund F in account A. These are our decision variables—variables that we’re trying to solve for. Let’s plug in some balances to see what the expected value of V is with Joe’s current holdings: V=0.07*5500+0.04*5500+0.06*2750+0.05*2750=907.5 &nbsp; Certainly, we can do better. We cannot just assign arbitrarily large values to the decision variables due to two restrictions which cannot be violated: Joe must maintain $11,000 in his taxable account and $5,500 in his Roth IRA. We cannot assign Joe more money than he already has, nor can we move money between his Roth IRA and taxable accounts. Joe’s overall portfolio must also maintain its allocation of 50% stocks and 50% bonds—the risk profile he selected. We don’t want to invest all of his money into a single fund. Mathematically, it’s straightforward to represent the first restriction as two linear constraints. Simply put, we’ve asserted that the sum of the balances of every fund in Joe’s taxable account must remain at $11,000. Similarly, the sum of the balances of every fund in his Roth IRA must remain at $5,500. The second restriction—maintaining the portfolio allocation of 50% stocks and 50% bonds—might seem straightforward, but there’s a catch. You might guess that you can express it as follows: The above statements assert that the sum of the balances of VTI across Joe’s accounts must be equal to half of his total balance. Similarly, we’re also asserting that the sum of the balances of VWOB across Joe’s accounts must be equal to the remaining half of his total balance. While this will certainly work for this particular example, enforcing that the portfolio allocation is exactly on target when determining optimality turns out to be too restrictive. In certain scenarios, it’s undesirable to buy or to sell a specific fund because of tax consequences. These restrictions require us to allow for some portfolio drift—some deviation from the target allocation. We made the decision to maximize the expected after-tax value of a customer’s holdings after having achieved the minimum possible drift. To accomplish this, we need to define new decision variables. Let’s add them to our objective function: is the dollar amount above the target balance in asset class AC. Similarly, is the dollar amount below the target balance in asset class AC. For instance, is the dollar amount above the target balance in emerging markets bonds—the asset class to where VWOB belongs. We still want to maximize our objective function V. However, with the introduction of the drift terms, we want every dollar allocated toward a single fund to incur a penalty if it moves the target balance for that fund’s asset class below or above its target amount. To do this, we can relate the terms with the terms using linear constraints. &nbsp; As shown above, we’ve asserted that the sum of the balances in funds including U.S. total market stocks (in this case, only VTI), plus some net drift amount in that asset class, must be equal to the target balance of that asset class in the portfolio (which in this case, is 50% of Joe’s total holdings). Similarly, we’ve also done this for emerging markets bonds. This way, if we can’t achieve perfect allocation, we have a buffer that we can fill—albeit at a penalty. Now that we have our objective function and constraints set up, we just need to solve these equations. For this we can use a mathematical programming solver. Here’s the optimal solution: Managing Engineering Complexity Reaching the optimal balances would require our system to buy and sell securities in Joe’s investment accounts. It’s not always free for Joe to go from his current holdings to optimal ones because buying and selling securities can have tax consequences. For example, if our system sold something at a short-term capital gain in Joe’s taxable account, or bought a security in his Roth IRA that was sold at a loss in the last 30 days—triggering the wash-sale rule, we would be negatively impacting his after-tax return. In the simple example above with two accounts and two funds, there are a total of four constraints. Our production model is orders of magnitude more complex, and considers each Betterment customer’s individual tax lots, which introduces hundreds of individual constraints to our model. Generating these constraints that ultimately determine buying and selling decisions can often involve tricky business logic that examines a variety of data in our system. In addition, we knew that as our work on TCP progressed, we were going to need to iterate on our mathematical model. Before diving head first into the code, we made it a priority to be cognizant of the engineering challenges we would face. Key Principles for Using Tax Coordination on a Retirement Goal As a result, we wanted to make sure that the software we built respected four key principles, which are: Isolation from third-party solver APIs. Ability to keep pace with changes to the mathematical model, e.g., adding, removing, and changing the constraints and the objective function must be quick and painless. Separation of concerns between how we accessed data in our system and the business logic defining algorithmic behavior. Easy and comprehensive testing. We built our own internal framework for modeling mathematical programs that was not tied to our trading system’s domain-specific business logic. This gave us the flexibility to switch easily between a variety of third-party mathematical programming solvers. Our business logic that generates the model knows only about objects defined by our framework, and not about third-party APIs. To incorporate a third-party solver into our system, we built a translation layer that received our system-generated constraints and objective function as inputs, and utilized those inputs to solve the model using a third-party API. Switching between third-party solvers simply meant switching implementations of the interface below. We wanted that same level of flexibility in changing our mathematical model. Changing the objective function and adding new constraints needed to be easy to do. We did this by providing well-defined interfaces that give engineers access to core system data needed to generate our model. This means that an engineer implementing a change to the model would only need to worry about implementing algorithmic behavior, and not about how to retrieve the data needed to do that. To add a new set of constraints, engineers simply provide an implementation of a TradingConstraintGenerator. Each TradingConstraintGenerator knows about all of the system related data it needs to generate constraints. Through dependency injection, the new generator is included among the set of generators used to generate constraints. The sample code below illustrates how we generated the constraints for our model. With hundreds of constraints and hundreds of thousands of unique tax profiles across our customer base, we needed to be confident that our system made the right decisions in the right situations. For us, that meant having clear, readable tests that were a joy to write. Below is a test written in Groovy, which sets up fixture data that mimics the exact situation in our “Meet Joe” example. We not only had unit tests such as the one above to test simple scenarios where a human could calculate the outcome, but we also ran the optimizer in a simulated production-like environment, through hundreds of thousands of scenarios that closely resembled real ones. During testing, we often ran into scenarios where our model had no feasible solution—usually due to a bug we had introduced. As soon as the bug was fixed, we wanted to ensure that we had automated tests to handle a similar issue in the future. However, with so many sources of input affecting the optimized result, writing tests to cover these cases was very labor-intensive. Instead, we automated the test setup by building tools that could snapshot our input data as of the time the error occurred. The input data was serialized and automatically fed back into our test fixtures. Striving for Simplicity At Betterment, we aim to build products that help our customers reach their financial goals. Building new products can often be done using our existing engineering abstractions. However, TCP brought a new level of complexity that required us to rethink the way parts of our trading system were built. Modeling and implementing our portfolio management algorithms using linear programming was not easy, but it ultimately resulted in the simplest possible system needed to reliably pursue optimal after-tax returns. To learn more about engineering at Betterment, visit the engineering page on the Betterment Resource Center. All return examples and return figures mentioned above are for illustrative purposes only. For much more on our TCP research, including additional considerations on the suitability of TCP to your circumstances, please see our white paper. See full disclosure for our estimates and Tax Coordination in general.
              </div>
              <span class="readingTime"></span>
              <div id="hs_cos_wrapper_module_1629497677" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module">

<div class="social-container">
   
      
   <span id="hs_cos_wrapper_module_1629497677_my_social_sharing" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_social_sharing" style="" data-hs-cos-general-type="widget" data-hs-cos-type="social_sharing"></span>
   
   <ul class="flex flex-middle social-items"> 
      
         <li>
            <a href="http://www.facebook.com/share.php?u=https://www.betterment.com/engineering/how-we-engineered-tax-coordinated-portfolio?utm_medium%3Dsocial%26utm_source%3Demail" target="_blank" rel="noopener noreferrer">
               <svg fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 16 16" aria-label="Betterment on Facebook" role="img"><title>Betterment on Facebook</title><path d="M9.5 3H12V0H9.5C7.5 0 6 1.6 6 3.5V5H4v3h2v8h3V8h2.5l.5-3H9V3.5c0-.3.2-.5.5-.5"></path></svg>
            </a>
         </li>
      
         <li>
            <a href="https://twitter.com/intent/tweet?original_referer=https://www.betterment.com/engineering/how-we-engineered-tax-coordinated-portfolio?utm_medium%3Dsocial%26utm_source%3Demail&amp;url=https://www.betterment.com/engineering/how-we-engineered-tax-coordinated-portfolio?utm_medium%3Dsocial%26utm_source%3Demail&amp;source=tweetbutton&amp;text=How+We+Engineered+Betterment%E2%80%99s+Tax-Coordinated+Portfolio%E2%84%A2" target="_blank" rel="noopener noreferrer">
               <svg fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 16 16" aria-label="Betterment on Twitter" role="img"> <title>Betterment on Twitter</title> <path d="M16 2.7c-.6.3-1.2.5-1.9.5.7-.4 1.2-1 1.5-1.8a6 6 0 01-2.1.8 3.3 3.3 0 00-5.6 3A9.3 9.3 0 011 1.8a3.3 3.3 0 001 4.4c-.5 0-1-.2-1.5-.4 0 1.6 1.2 3 2.7 3.2a3.3 3.3 0 01-1.5 0 3.3 3.3 0 003 2.4A6.6 6.6 0 010 12.7a9.3 9.3 0 0014.4-8.3c.6-.4 1.2-1 1.6-1.7"></path> </svg>
            </a>
         </li>
      
         <li>
            <a href="mailto:?subject=Check%20out%20https://www.betterment.com/engineering/how-we-engineered-tax-coordinated-portfolio?utm_medium%3Dsocial%26utm_source%3Demail%20&amp;body=Check%20out%20https://www.betterment.com/engineering/how-we-engineered-tax-coordinated-portfolio?utm_medium%3Dsocial%26utm_source%3Demail" target="_blank" rel="noopener noreferrer">
               <svg viewbox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg" aria-label="Betterment Email Share"><title>Betterment Email Share</title><path fill-rule="evenodd" clip-rule="evenodd" d="M1 4H16V15H1V4ZM2.5 13.4286V7.53571L8.5 11.4643L14.5 7.53571V13.4286H2.5ZM14.5 5.57143H2.5L8.5 9.5L14.5 5.57143Z" /></svg>
            </a>
         </li>
      

      
         <li class="copy-clip-container">
            <button aria-label="Copy Post Link" class="bt-UnstyledButton copy-clip-button">
               <svg viewbox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg" aria-label="Betterment Clipboard Share"><title>Betterment Clipboard Share</title><path fill-rule="evenodd" clip-rule="evenodd" d="M2.53333 5.13332C2.83406 4.82896 3.19221 4.58731 3.58703 4.42238C3.98184 4.25746 4.40546 4.17253 4.83333 4.17253C5.26121 4.17253 5.68483 4.25746 6.07964 4.42238C6.47445 4.58731 6.8326 4.82896 7.13333 5.13332L9.03333 7.03332L8.2 7.86666L6.3 5.96666C5.89446 5.64917 5.38639 5.49179 4.87239 5.52443C4.35839 5.55707 3.87432 5.77746 3.5122 6.1437C3.15008 6.50993 2.93517 6.99647 2.90834 7.5108C2.88151 8.02514 3.04462 8.5314 3.36667 8.93332L5.26667 10.8L4.43333 11.6333L2.53333 9.73332C2.22897 9.43259 1.98732 9.07444 1.82239 8.67963C1.65746 8.28482 1.57254 7.8612 1.57254 7.43332C1.57254 7.00545 1.65746 6.58183 1.82239 6.18702C1.98732 5.79221 2.22897 5.43405 2.53333 5.13332V5.13332Z" /> <path fill-rule="evenodd" clip-rule="evenodd" d="M11.8667 14.4667C12.4733 13.8549 12.8136 13.0282 12.8136 12.1667C12.8136 11.3051 12.4733 10.4785 11.8667 9.86666L9.96667 7.96666L9.13334 8.79999L11.0333 10.7C11.4223 11.089 11.6408 11.6166 11.6408 12.1667C11.6408 12.7168 11.4223 13.2443 11.0333 13.6333C10.6444 14.0223 10.1168 14.2408 9.56667 14.2408C9.01656 14.2408 8.48899 14.0223 8.1 13.6333L6.2 11.7333L5.36667 12.5667L7.26667 14.4667C7.87847 15.0733 8.70513 15.4136 9.56667 15.4136C10.4282 15.4136 11.2549 15.0733 11.8667 14.4667V14.4667Z" /> <path fill-rule="evenodd" clip-rule="evenodd" d="M9.13334 12.5667L4.43333 7.86667L5.26667 7.03334L9.96667 11.7333L9.13334 12.5667V12.5667Z" /></svg>
            </button>
            <div class="copy-clip-confirmation">
               <p>Copied!</p>
            </div>
         </li>
      
   </ul>
   
</div>

</div>
            </div>
          </div>
        </div>

        <div class="bt-container bt-container_small">
          <div class="blog-post-body">
            <span id="hs_cos_wrapper_post_body" class="hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_rich_text" style="" data-hs-cos-general-type="meta_field" data-hs-cos-type="rich_text"><!--more--> 
<p>Tax efficiency is a key consideration of Betterment’s portfolio management philosophy.</p> 
<p>With our new Tax Coordination feature, we’re continuing the mission to help our customers’ portfolios become as tax efficient as possible.</p> 
<p>While new products can often be achieved using our existing engineering abstractions, TCP brought the engineering team a new level of complexity that required us to rethink how parts of our portfolio management system were built.</p> 
<p><img src="../hubfs/Imported_Blog_Media/BMT_1328-1.jpg" alt="howweengineeredTCP"></p> 
<p>Here’s how we did it.</p> 
<h2>A Primer on Tax Coordination</h2> 
<p>Betterment’s TCP feature is our very own, fully automated version of an investment strategy known as asset location.</p> 
<p>If you’re not familiar with asset location, it is a strategy designed to optimize after-tax returns by placing tax-inefficient securities into more tax-advantaged accounts, such as 401(k)s and Individual Retirement Accounts (IRAs).</p> 
<p>Before we built TCP, Betterment customers had each account managed as a separate, standalone portfolio.</p> 
<p>For example, customers could set up a Roth IRA with a portfolio of 90% stocks and 10% bonds to save for retirement.</p> 
<p>Separately, they could set up a taxable retirement account invested likewise in 90% stocks and 10% bonds.</p> 
<p>Now, Betterment customers can turn on TCP in their accounts, and their holdings in multiple investment accounts will be managed as a single portfolio allocation, but rearranged in such a way that the holdings across those accounts seek to maximize the overall portfolio’s after-tax returns.</p> 
<p>To illustrate, let’s suppose you’re a Betterment customer with three different accounts: a Roth IRA, a traditional IRA, and a taxable retirement account.</p> 
<p>Let’s say that each account holds $50,000, for a total of $150,000 in investments.</p> 
<p>Now assume that the $50,000 in each account is invested into a portfolio of 70% stocks and 30% bonds.</p> 
<p>For reference, consider the diagram. The circles represent various asset classes, and the bar shows the allocation for all the accounts, if added together.</p> 
<p><img src="../hubfs/Imported_Blog_Media/allocation-by-aggregate-and-account-tcp-off-03-2.png" alt="allocation-by-aggregate-and-account-tcp-off-03"></p> 
<p>Each account has a 70/30 allocation, and the accounts will add up to 70/30 in the aggregate, but we can do better when it comes to maximizing after-tax returns.</p> 
<p>We can maintain the aggregate 70/30 asset allocation, but use the available balances of $50,000 each, to rearrange the securities in such a way that places the most tax-efficient holdings into a taxable account, and the most tax-inefficient ones into IRAs. Here’s a simple animation solely for illustrative purposes:</p> 
<p><strong>Asset Location&nbsp;in Action</strong></p> 
<p><img src="../hubfs/Imported_Blog_Media/AssetClassesAnimation-3.gif" alt="AssetClassesAnimation"></p> 
<p>The result is the same 70/30 allocation overall, except TCP has now redistributed the assets unevenly, to reduce future taxes.</p> 
<p><img src="../hubfs/Imported_Blog_Media/allocation-by-aggregate-and-account-tcp-on-03-2.png" alt="allocation-by-aggregate-and-account-tcp-on-03"></p> 
<h2>How We Modeled the Problem</h2> 
<p>The fundamental questions the engineering team tried to answer were: How do we get our customers to this optimal state, and how do we maintain it in the presence of daily account activity?</p> 
<p>We could have attempted to construct a procedural-style heuristic solution to this, but the complexity of the problem led us to believe this approach would be hard to implement and challenging to maintain.</p> 
<p>Instead, we opted to model our problem as a <a href="https://en.wikipedia.org/wiki/Linear_programming" target="_blank" rel="noopener noreferrer">linear program</a>. This made the problem provably solvable and quick to compute—on the order of milliseconds per customer. Let’s consider a hypothetical customer account example.</p> 
<h3>Meet Joe</h3> 
<p>Joe is a hypothetical Betterment customer. When he signed up for Betterment, he opened a Roth IRA account.</p> 
<p>As an avid saver, Joe quickly reached his annual Roth IRA contribution limit of $5,500. Wanting to save more for his retirement, he decided to open up a Betterment taxable account, which he funded with an additional $11,000.</p> 
<p><em>Note that the contribution limits mentioned in this example are as of the time this article was published. Limits are subject to change from year to year, so please defer to IRS guidelines for current limits.&nbsp;<a href="https://www.irs.gov/retirement-plans/401k-plans-deferrals-and-matching-when-compensation-exceeds-the-annual-limit">See IRA limits here and 401(k) limits</a>.</em></p> 
<p>Joe isn’t one to take huge risks, so he opted for a moderate asset allocation of 50% stocks and 50% bonds in both his Roth IRA and taxable accounts.</p> 
<p>To make things simple, let’s assume that both portfolios are only invested in two asset classes: U.S. total market stocks and emerging markets bonds.</p> 
<p>In his taxable account, Joe holds $5,500 worth of U.S. total market stocks in VTI (Vanguard Total Stock Market ETF), and $5,500 worth of emerging markets bonds in VWOB (Vanguard Emerging Markets Bond ETF).</p> 
<p>Let’s say that his Roth IRA holds $2,750 of VTI, and $2,750 of VWOB.</p> 
<p>Below is a table summarizing Joe’s holdings:</p> 
<table> 
 <tbody> 
  <tr> 
   <th style="text-align: left;">Account Type:</th> 
   <th style="text-align: right;">VTI (U.S. Total Market)</th> 
   <th style="text-align: right;">VWOB (Emerging Markets Bonds)</th> 
   <th style="text-align: right;">Account Total</th> 
  </tr> 
  <tr> 
   <td><strong>Taxable</strong></td> 
   <td style="text-align: right;">$5,500</td> 
   <td style="text-align: right;">$5,500</td> 
   <td style="text-align: right;">$11,000</td> 
  </tr> 
  <tr> 
   <td style="text-align: left;"><strong>Roth</strong></td> 
   <td style="text-align: right;">$2,750</td> 
   <td style="text-align: right;">$2,750</td> 
   <td style="text-align: right;">$5,500</td> 
  </tr> 
  <tr> 
   <td><strong>Asset Class Total</strong></td> 
   <td style="text-align: right;">$8,250</td> 
   <td style="text-align: right;">$8,250</td> 
   <td style="text-align: right;">$16,500</td> 
  </tr> 
 </tbody> 
</table> 
<p>To begin to construct our model for an optimal asset location strategy, we need to consider the relative value of each fund in both accounts. A number of factors are used to determine this, but most importantly each fund’s tax efficiency and expected returns.</p> 
<p>Let’s assume we already know that VTI has a higher expected value in Joe’s taxable account, and that VWOB has a higher expected value in his Roth IRA. To be more concrete about this, let’s define some variables.</p> 
<p><img src="../hs-fs/hubfs/Imported_Blog_Media/latex_1-1b183.png?width=348&amp;height=302&amp;name=latex_1-1.png" alt="latex equation 1" width="348" height="302" srcset="https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_1-1.png?width=174&amp;height=151&amp;name=latex_1-1.png 174w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_1-1.png?width=348&amp;height=302&amp;name=latex_1-1.png 348w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_1-1.png?width=522&amp;height=453&amp;name=latex_1-1.png 522w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_1-1.png?width=696&amp;height=604&amp;name=latex_1-1.png 696w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_1-1.png?width=870&amp;height=755&amp;name=latex_1-1.png 870w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_1-1.png?width=1044&amp;height=906&amp;name=latex_1-1.png 1044w" sizes="(max-width: 348px) 100vw, 348px"></p> 
<p>&nbsp;</p> 
<p>Each variable represents the expected value of holding a particular fund in a particular account.</p> 
<p>For example, we’re representing the expected value of holding VTI in your Taxable as</p> 
<p><img src="../hs-fs/hubfs/Imported_Blog_Media/latex_2-1d6c7.png?width=166&amp;height=56&amp;name=latex_2-1.png" alt="latex equation 2" width="166" height="56" srcset="https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_2-1.png?width=83&amp;height=28&amp;name=latex_2-1.png 83w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_2-1.png?width=166&amp;height=56&amp;name=latex_2-1.png 166w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_2-1.png?width=249&amp;height=84&amp;name=latex_2-1.png 249w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_2-1.png?width=332&amp;height=112&amp;name=latex_2-1.png 332w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_2-1.png?width=415&amp;height=140&amp;name=latex_2-1.png 415w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_2-1.png?width=498&amp;height=168&amp;name=latex_2-1.png 498w" sizes="(max-width: 166px) 100vw, 166px"></p> 
<p>which we’ve defined to be 0.07. More generally, Let’s let</p> 
<p><img src="../hs-fs/hubfs/Imported_Blog_Media/latex_3-10ac8.png?width=66&amp;height=54&amp;name=latex_3-1.png" alt="latex equation 3" width="66" height="54" srcset="https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_3-1.png?width=33&amp;height=27&amp;name=latex_3-1.png 33w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_3-1.png?width=66&amp;height=54&amp;name=latex_3-1.png 66w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_3-1.png?width=99&amp;height=81&amp;name=latex_3-1.png 99w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_3-1.png?width=132&amp;height=108&amp;name=latex_3-1.png 132w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_3-1.png?width=165&amp;height=135&amp;name=latex_3-1.png 165w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_3-1.png?width=198&amp;height=162&amp;name=latex_3-1.png 198w" sizes="(max-width: 66px) 100vw, 66px"></p> 
<p>be the expected value of holding fund <em>F</em> in account <em>A</em>. Circling back to the original problem, we want to rearrange the holdings in Joe’s accounts in a way that’s maximally valuable in the future.</p> 
<p>Linear programs try to optimize the value of an objective function. In this example, we want to maximize the expected value of the holdings in Joe’s accounts. The overall value of Joe’s holdings are a function of the specific funds in which he has investments. Let’s define that objective function.</p> 
<p><img src="../hs-fs/hubfs/Imported_Blog_Media/latex_4-1e13e.png?width=1460&amp;height=64&amp;name=latex_4-1.png" alt="latex equation 3" width="1460" height="64" srcset="https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_4-1.png?width=730&amp;height=32&amp;name=latex_4-1.png 730w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_4-1.png?width=1460&amp;height=64&amp;name=latex_4-1.png 1460w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_4-1.png?width=2190&amp;height=96&amp;name=latex_4-1.png 2190w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_4-1.png?width=2920&amp;height=128&amp;name=latex_4-1.png 2920w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_4-1.png?width=3650&amp;height=160&amp;name=latex_4-1.png 3650w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_4-1.png?width=4380&amp;height=192&amp;name=latex_4-1.png 4380w" sizes="(max-width: 1460px) 100vw, 1460px"></p> 
<p>&nbsp;</p> 
<p>You’ll notice the familiar</p> 
<p><img src="../hs-fs/hubfs/Imported_Blog_Media/latex_3-10ac8.png?width=66&amp;height=54&amp;name=latex_3-1.png" alt="latex equation 4" width="66" height="54" srcset="https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_3-1.png?width=33&amp;height=27&amp;name=latex_3-1.png 33w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_3-1.png?width=66&amp;height=54&amp;name=latex_3-1.png 66w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_3-1.png?width=99&amp;height=81&amp;name=latex_3-1.png 99w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_3-1.png?width=132&amp;height=108&amp;name=latex_3-1.png 132w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_3-1.png?width=165&amp;height=135&amp;name=latex_3-1.png 165w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_3-1.png?width=198&amp;height=162&amp;name=latex_3-1.png 198w" sizes="(max-width: 66px) 100vw, 66px"></p> 
<p>terms—measuring the expected value of holding each fund in each account, but also you’ll notice variables of the form</p> 
<p><img src="../hs-fs/hubfs/Imported_Blog_Media/latex_5-10108.png?width=72&amp;height=52&amp;name=latex_5-1.png" alt="latex equation 5" width="72" height="52" srcset="https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_5-1.png?width=36&amp;height=26&amp;name=latex_5-1.png 36w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_5-1.png?width=72&amp;height=52&amp;name=latex_5-1.png 72w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_5-1.png?width=108&amp;height=78&amp;name=latex_5-1.png 108w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_5-1.png?width=144&amp;height=104&amp;name=latex_5-1.png 144w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_5-1.png?width=180&amp;height=130&amp;name=latex_5-1.png 180w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_5-1.png?width=216&amp;height=156&amp;name=latex_5-1.png 216w" sizes="(max-width: 72px) 100vw, 72px"></p> 
<p>Precisely, this variable represents the balance of fund <em>F</em> in account <em>A</em>. These are our <i>decision variables</i>—variables that we’re trying to solve for. Let’s plug in some balances to see what the expected value of <em>V</em> is with Joe’s current holdings:</p> 
<p style="text-align: center;">V=0.07*5500+0.04*5500+0.06*2750+0.05*2750=907.5</p> 
<p>&nbsp;</p> 
<p>Certainly, we can do better. We cannot just assign arbitrarily large values to the decision variables due to two restrictions which cannot be violated:</p> 
<p>Joe must maintain $11,000 in his taxable account and $5,500 in his Roth IRA. We cannot assign Joe more money than he already has, nor can we move money between his Roth IRA and taxable accounts. Joe’s overall portfolio must also maintain its allocation of 50% stocks and 50% bonds—the risk profile he selected. We don’t want to invest all of his money into a single fund.</p> 
<p>Mathematically, it’s straightforward to represent the first restriction as two linear constraints.</p> 
<p><img src="../hs-fs/hubfs/Imported_Blog_Media/latex_6-15447.png?width=572&amp;height=142&amp;name=latex_6-1.png" alt="latex equation 6" width="572" height="142" srcset="https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_6-1.png?width=286&amp;height=71&amp;name=latex_6-1.png 286w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_6-1.png?width=572&amp;height=142&amp;name=latex_6-1.png 572w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_6-1.png?width=858&amp;height=213&amp;name=latex_6-1.png 858w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_6-1.png?width=1144&amp;height=284&amp;name=latex_6-1.png 1144w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_6-1.png?width=1430&amp;height=355&amp;name=latex_6-1.png 1430w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_6-1.png?width=1716&amp;height=426&amp;name=latex_6-1.png 1716w" sizes="(max-width: 572px) 100vw, 572px"></p> 
<p>Simply put, we’ve asserted that the sum of the balances of every fund in Joe’s taxable account must remain at $11,000. Similarly, the sum of the balances of every fund in his Roth IRA must remain at $5,500.</p> 
<p>The second restriction—maintaining the portfolio allocation of 50% stocks and 50% bonds—might seem straightforward, but there’s a catch. You might guess that you can express it as follows:</p> 
<p><img src="../hs-fs/hubfs/Imported_Blog_Media/latex_7-1bf73.png?width=816&amp;height=132&amp;name=latex_7-1.png" alt="latex equation 7" width="816" height="132" srcset="https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_7-1.png?width=408&amp;height=66&amp;name=latex_7-1.png 408w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_7-1.png?width=816&amp;height=132&amp;name=latex_7-1.png 816w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_7-1.png?width=1224&amp;height=198&amp;name=latex_7-1.png 1224w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_7-1.png?width=1632&amp;height=264&amp;name=latex_7-1.png 1632w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_7-1.png?width=2040&amp;height=330&amp;name=latex_7-1.png 2040w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_7-1.png?width=2448&amp;height=396&amp;name=latex_7-1.png 2448w" sizes="(max-width: 816px) 100vw, 816px"></p> 
<p>The above statements assert that the sum of the balances of VTI across Joe’s accounts must be equal to half of his total balance. Similarly, we’re also asserting that the sum of the balances of VWOB across Joe’s accounts must be equal to the remaining half of his total balance.</p> 
<p>While this will certainly work for this particular example, enforcing that the portfolio allocation is exactly on target when determining optimality turns out to be too restrictive.</p> 
<p>In certain scenarios, it’s undesirable to buy or to sell a specific fund because of tax consequences. These restrictions require us to allow for some portfolio drift—some deviation from the target allocation.</p> 
<p>We made the decision to maximize the expected after-tax value of a customer’s holdings after having achieved the minimum possible drift. To accomplish this, we need to define new decision variables. Let’s add them to our objective function:</p> 
<p><img src="../hs-fs/hubfs/Imported_Blog_Media/latex_8-196a9.png?width=1664&amp;height=64&amp;name=latex_8-1.png" alt="latex equation 8" width="1664" height="64" srcset="https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_8-1.png?width=832&amp;height=32&amp;name=latex_8-1.png 832w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_8-1.png?width=1664&amp;height=64&amp;name=latex_8-1.png 1664w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_8-1.png?width=2496&amp;height=96&amp;name=latex_8-1.png 2496w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_8-1.png?width=3328&amp;height=128&amp;name=latex_8-1.png 3328w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_8-1.png?width=4160&amp;height=160&amp;name=latex_8-1.png 4160w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_8-1.png?width=4992&amp;height=192&amp;name=latex_8-1.png 4992w" sizes="(max-width: 1664px) 100vw, 1664px"></p> 
<p><img src="../hs-fs/hubfs/Imported_Blog_Media/latex_9-1e43a.png?width=72&amp;height=62&amp;name=latex_9-1.png" alt="latex equation 9" width="72" height="62" srcset="https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_9-1.png?width=36&amp;height=31&amp;name=latex_9-1.png 36w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_9-1.png?width=72&amp;height=62&amp;name=latex_9-1.png 72w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_9-1.png?width=108&amp;height=93&amp;name=latex_9-1.png 108w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_9-1.png?width=144&amp;height=124&amp;name=latex_9-1.png 144w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_9-1.png?width=180&amp;height=155&amp;name=latex_9-1.png 180w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_9-1.png?width=216&amp;height=186&amp;name=latex_9-1.png 216w" sizes="(max-width: 72px) 100vw, 72px"></p> 
<p>is the dollar amount above the target balance in asset class <em>AC</em>.</p> 
<p>Similarly,</p> 
<p><img src="../hs-fs/hubfs/Imported_Blog_Media/latex_10-1141d.png?width=78&amp;height=60&amp;name=latex_10-1.png" alt="latex equation 10" width="78" height="60" srcset="https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_10-1.png?width=39&amp;height=30&amp;name=latex_10-1.png 39w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_10-1.png?width=78&amp;height=60&amp;name=latex_10-1.png 78w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_10-1.png?width=117&amp;height=90&amp;name=latex_10-1.png 117w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_10-1.png?width=156&amp;height=120&amp;name=latex_10-1.png 156w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_10-1.png?width=195&amp;height=150&amp;name=latex_10-1.png 195w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_10-1.png?width=234&amp;height=180&amp;name=latex_10-1.png 234w" sizes="(max-width: 78px) 100vw, 78px"></p> 
<p>is the dollar amount below the target balance in asset class <em>AC</em>.</p> 
<p>For instance,</p> 
<p><img src="../hs-fs/hubfs/Imported_Blog_Media/latex_11-1fd44.png?width=94&amp;height=60&amp;name=latex_11-1.png" alt="latex equation 11" width="94" height="60" srcset="https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_11-1.png?width=47&amp;height=30&amp;name=latex_11-1.png 47w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_11-1.png?width=94&amp;height=60&amp;name=latex_11-1.png 94w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_11-1.png?width=141&amp;height=90&amp;name=latex_11-1.png 141w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_11-1.png?width=188&amp;height=120&amp;name=latex_11-1.png 188w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_11-1.png?width=235&amp;height=150&amp;name=latex_11-1.png 235w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_11-1.png?width=282&amp;height=180&amp;name=latex_11-1.png 282w" sizes="(max-width: 94px) 100vw, 94px"></p> 
<p>is the dollar amount above the target balance in emerging markets bonds—the asset class to where VWOB belongs.</p> 
<p>We still want to maximize our objective function <em>V</em>. However, with the introduction of the drift terms, we want every dollar allocated toward a single fund to incur a penalty if it moves the target balance for that fund’s asset class below or above its target amount. To do this, we can relate the</p> 
<p><img src="../hs-fs/hubfs/Imported_Blog_Media/latex_5-10108.png?width=72&amp;height=52&amp;name=latex_5-1.png" alt="latex equation 5" width="72" height="52" srcset="https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_5-1.png?width=36&amp;height=26&amp;name=latex_5-1.png 36w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_5-1.png?width=72&amp;height=52&amp;name=latex_5-1.png 72w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_5-1.png?width=108&amp;height=78&amp;name=latex_5-1.png 108w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_5-1.png?width=144&amp;height=104&amp;name=latex_5-1.png 144w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_5-1.png?width=180&amp;height=130&amp;name=latex_5-1.png 180w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_5-1.png?width=216&amp;height=156&amp;name=latex_5-1.png 216w" sizes="(max-width: 72px) 100vw, 72px"></p> 
<p>terms with the</p> 
<p><img src="../hs-fs/hubfs/Imported_Blog_Media/latex_12-14499.png?width=80&amp;height=64&amp;name=latex_12-1.png" alt="latext equation 12" width="80" height="64" srcset="https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_12-1.png?width=40&amp;height=32&amp;name=latex_12-1.png 40w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_12-1.png?width=80&amp;height=64&amp;name=latex_12-1.png 80w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_12-1.png?width=120&amp;height=96&amp;name=latex_12-1.png 120w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_12-1.png?width=160&amp;height=128&amp;name=latex_12-1.png 160w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_12-1.png?width=200&amp;height=160&amp;name=latex_12-1.png 200w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_12-1.png?width=240&amp;height=192&amp;name=latex_12-1.png 240w" sizes="(max-width: 80px) 100vw, 80px"></p> 
<p>terms using linear constraints.</p> 
<p><img src="../hs-fs/hubfs/Imported_Blog_Media/latex_13-1b717.png?width=1082&amp;height=132&amp;name=latex_13-1.png" alt="latex equation 13" width="1082" height="132" srcset="https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_13-1.png?width=541&amp;height=66&amp;name=latex_13-1.png 541w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_13-1.png?width=1082&amp;height=132&amp;name=latex_13-1.png 1082w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_13-1.png?width=1623&amp;height=198&amp;name=latex_13-1.png 1623w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_13-1.png?width=2164&amp;height=264&amp;name=latex_13-1.png 2164w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_13-1.png?width=2705&amp;height=330&amp;name=latex_13-1.png 2705w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_13-1.png?width=3246&amp;height=396&amp;name=latex_13-1.png 3246w" sizes="(max-width: 1082px) 100vw, 1082px"></p> 
<p>&nbsp;</p> 
<p>As shown above, we’ve asserted that the sum of the balances in funds including U.S. total market stocks (in this case, only VTI), plus some net drift amount in that asset class, must be equal to the target balance of that asset class in the portfolio (which in this case, is 50% of Joe’s total holdings). Similarly, we’ve also done this for emerging markets bonds. This way, if we can’t achieve perfect allocation, we have a buffer that we can fill—albeit at a penalty.</p> 
<p>Now that we have our objective function and constraints set up, we just need to solve these equations. For this we can use a mathematical programming solver. Here’s the optimal solution:</p> 
<p><img src="../hs-fs/hubfs/Imported_Blog_Media/latex_14-1ac27.png?width=658&amp;height=380&amp;name=latex_14-1.png" alt="latex equation 14" width="658" height="380" srcset="https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_14-1.png?width=329&amp;height=190&amp;name=latex_14-1.png 329w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_14-1.png?width=658&amp;height=380&amp;name=latex_14-1.png 658w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_14-1.png?width=987&amp;height=570&amp;name=latex_14-1.png 987w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_14-1.png?width=1316&amp;height=760&amp;name=latex_14-1.png 1316w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_14-1.png?width=1645&amp;height=950&amp;name=latex_14-1.png 1645w, https://www.betterment.com/hs-fs/hubfs/Imported_Blog_Media/latex_14-1.png?width=1974&amp;height=1140&amp;name=latex_14-1.png 1974w" sizes="(max-width: 658px) 100vw, 658px"></p> 
<h2>Managing Engineering Complexity</h2> 
<p>Reaching the optimal balances would require our system to buy and sell securities in Joe’s investment accounts. It’s not always free for Joe to go from his current holdings to optimal ones because buying and selling securities can have tax consequences.</p> 
<p>For example, if our system sold something at a <a href="https://www.investopedia.com/terms/c/capitalgain.asp" target="_blank" rel="noopener noreferrer">short-term capital gain</a> in Joe’s taxable account, or bought a security in his Roth IRA that was sold at a loss in the last 30 days—triggering the <a href="../resources/understanding-tax-loss-harvesting/index.html#19" target="_blank" rel="noopener noreferrer">wash-sale rule</a>, we would be negatively impacting his after-tax return.</p> 
<p>In the simple example above with two accounts and two funds, there are a total of four constraints. Our production model is orders of magnitude more complex, and considers each Betterment customer’s individual tax lots, which introduces hundreds of individual constraints to our model.</p> 
<p>Generating these constraints that ultimately determine buying and selling decisions can often involve tricky business logic that examines a variety of data in our system. In addition, we knew that as our work on TCP progressed, we were going to need to iterate on our mathematical model. Before diving head first into the code, we made it a priority to be cognizant of the engineering challenges we would face.</p> 
<h3>Key Principles for Using Tax Coordination on a Retirement Goal</h3> 
<p>As a result, we wanted to make sure that the software we built respected four key principles, which are:</p> 
<ol> 
 <li>Isolation from third-party solver APIs.</li> 
 <li>Ability to keep pace with changes to the mathematical model, e.g., adding, removing, and changing the constraints and the objective function must be quick and painless.</li> 
 <li>Separation of concerns between how we accessed data in our system and the business logic defining algorithmic behavior.</li> 
 <li>Easy and comprehensive testing.</li> 
</ol> 
<p>We built our own internal framework for modeling mathematical programs that was not tied to our trading system’s domain-specific business logic. This gave us the flexibility to switch easily between a variety of third-party mathematical programming solvers.</p> 
<p>Our business logic that generates the model knows only about objects defined by our framework, and not about third-party APIs. To incorporate a third-party solver into our system, we built a translation layer that received our system-generated constraints and objective function as inputs, and utilized those inputs to solve the model using a third-party API. Switching between third-party solvers simply meant switching implementations of the interface below.</p> 
<p><img src="../hubfs/Imported_Blog_Media/Screen-Shot-2016-09-26-at-3_11_05-PM-1.png" alt="Screen Shot 2016-09-26 at 3.11.05 PM"></p> 
<p>We wanted that same level of flexibility in changing our mathematical model. Changing the objective function and adding new constraints needed to be easy to do. We did this by providing well-defined interfaces that give engineers access to core system data needed to generate our model. This means that an engineer implementing a change to the model would only need to worry about implementing algorithmic behavior, and not about how to retrieve the data needed to do that.</p> 
<p>To add a new set of constraints, engineers simply provide an implementation of a <code>TradingConstraintGenerator</code>. Each <code>TradingConstraintGenerator</code> knows about all of the system related data it needs to generate constraints. Through dependency injection, the new generator is included among the set of generators used to generate constraints. The sample code below illustrates how we generated the constraints for our model.</p> 
<p><img src="../hubfs/Imported_Blog_Media/Screen-Shot-2016-09-26-at-4_19_18-PM-1.png" alt="Screen Shot 2016-09-26 at 4.19.18 PM"></p> 
<p>With <em>hundreds of constraints</em> and <em>hundreds of thousands of unique tax profiles</em> across our customer base, we needed to be confident that our system made the right decisions in the right situations. For us, that meant having clear, readable tests that were a joy to write.</p> 
<p>Below is a test written in Groovy, which sets up fixture data that mimics the exact situation in our “Meet Joe” example. <img src="../hubfs/Imported_Blog_Media/Screen-Shot-2016-09-26-at-2_44_22-PM-1.png" alt="Screen Shot 2016-09-26 at 2.44.22 PM"></p> 
<p>We not only had unit tests such as the one above to test simple scenarios where a human could calculate the outcome, but we also ran the optimizer in a simulated production-like environment, through hundreds of thousands of scenarios that closely resembled real ones. During testing, we often ran into scenarios where our model had no <a href="https://en.wikipedia.org/wiki/Feasible_region" target="_blank" rel="noopener noreferrer">feasible solution</a>—usually due to a bug we had introduced. As soon as the bug was fixed, we wanted to ensure that we had automated tests to handle a similar issue in the future. However, with so many sources of input affecting the optimized result, writing tests to cover these cases was very labor-intensive. Instead, we automated the test setup by building tools that could snapshot our input data as of the time the error occurred. The input data was serialized and automatically fed back into our test fixtures.</p> 
<h2>Striving for Simplicity</h2> 
<p>At Betterment, we aim to build products that help our customers reach their financial goals.</p> 
<p>Building new products can often be done using our existing engineering abstractions. However, TCP brought a new level of complexity that required us to rethink the way parts of our trading system were built.</p> 
<p>Modeling and implementing our portfolio management algorithms using linear programming was not easy, but it ultimately resulted in the simplest possible system needed to reliably pursue optimal after-tax returns.</p> 
<p>To learn more about engineering at Betterment, visit <a href="../resources/topics/inside-betterment/engineering/index.html" target="_blank" rel="noopener noreferrer">the engineering page on the Betterment Resource Center</a>.</p> 
<hr> 
<p><em>All return examples and return figures mentioned above are for illustrative purposes only. For much more on our TCP research, including additional considerations on the suitability of TCP to your circumstances, please see our <a href="../resources/research/tax-coordinated-portfolio-whitepaper/index.html" target="_blank" rel="noopener noreferrer">white paper</a>. <a href="../tcp-disclosures/index.html">See full disclosure</a> for our estimates and Tax Coordination in general.</em></p></span>
          </div>
        </div>

        




        <div class="bt-container bt-container_small">
          <div id="hs_cos_wrapper_module_1629497677" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module">

<div class="social-container">
   
      
   <span id="hs_cos_wrapper_module_1629497677_my_social_sharing" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_social_sharing" style="" data-hs-cos-general-type="widget" data-hs-cos-type="social_sharing"></span>
   
   <ul class="flex flex-middle social-items"> 
      
         <li>
            <a href="http://www.facebook.com/share.php?u=https://www.betterment.com/engineering/how-we-engineered-tax-coordinated-portfolio?utm_medium%3Dsocial%26utm_source%3Demail" target="_blank" rel="noopener noreferrer">
               <svg fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 16 16" aria-label="Betterment on Facebook" role="img"><title>Betterment on Facebook</title><path d="M9.5 3H12V0H9.5C7.5 0 6 1.6 6 3.5V5H4v3h2v8h3V8h2.5l.5-3H9V3.5c0-.3.2-.5.5-.5"></path></svg>
            </a>
         </li>
      
         <li>
            <a href="https://twitter.com/intent/tweet?original_referer=https://www.betterment.com/engineering/how-we-engineered-tax-coordinated-portfolio?utm_medium%3Dsocial%26utm_source%3Demail&amp;url=https://www.betterment.com/engineering/how-we-engineered-tax-coordinated-portfolio?utm_medium%3Dsocial%26utm_source%3Demail&amp;source=tweetbutton&amp;text=How+We+Engineered+Betterment%E2%80%99s+Tax-Coordinated+Portfolio%E2%84%A2" target="_blank" rel="noopener noreferrer">
               <svg fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 16 16" aria-label="Betterment on Twitter" role="img"> <title>Betterment on Twitter</title> <path d="M16 2.7c-.6.3-1.2.5-1.9.5.7-.4 1.2-1 1.5-1.8a6 6 0 01-2.1.8 3.3 3.3 0 00-5.6 3A9.3 9.3 0 011 1.8a3.3 3.3 0 001 4.4c-.5 0-1-.2-1.5-.4 0 1.6 1.2 3 2.7 3.2a3.3 3.3 0 01-1.5 0 3.3 3.3 0 003 2.4A6.6 6.6 0 010 12.7a9.3 9.3 0 0014.4-8.3c.6-.4 1.2-1 1.6-1.7"></path> </svg>
            </a>
         </li>
      
         <li>
            <a href="mailto:?subject=Check%20out%20https://www.betterment.com/engineering/how-we-engineered-tax-coordinated-portfolio?utm_medium%3Dsocial%26utm_source%3Demail%20&amp;body=Check%20out%20https://www.betterment.com/engineering/how-we-engineered-tax-coordinated-portfolio?utm_medium%3Dsocial%26utm_source%3Demail" target="_blank" rel="noopener noreferrer">
               <svg viewbox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg" aria-label="Betterment Email Share"><title>Betterment Email Share</title><path fill-rule="evenodd" clip-rule="evenodd" d="M1 4H16V15H1V4ZM2.5 13.4286V7.53571L8.5 11.4643L14.5 7.53571V13.4286H2.5ZM14.5 5.57143H2.5L8.5 9.5L14.5 5.57143Z" /></svg>
            </a>
         </li>
      

      
         <li class="copy-clip-container">
            <button aria-label="Copy Post Link" class="bt-UnstyledButton copy-clip-button">
               <svg viewbox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg" aria-label="Betterment Clipboard Share"><title>Betterment Clipboard Share</title><path fill-rule="evenodd" clip-rule="evenodd" d="M2.53333 5.13332C2.83406 4.82896 3.19221 4.58731 3.58703 4.42238C3.98184 4.25746 4.40546 4.17253 4.83333 4.17253C5.26121 4.17253 5.68483 4.25746 6.07964 4.42238C6.47445 4.58731 6.8326 4.82896 7.13333 5.13332L9.03333 7.03332L8.2 7.86666L6.3 5.96666C5.89446 5.64917 5.38639 5.49179 4.87239 5.52443C4.35839 5.55707 3.87432 5.77746 3.5122 6.1437C3.15008 6.50993 2.93517 6.99647 2.90834 7.5108C2.88151 8.02514 3.04462 8.5314 3.36667 8.93332L5.26667 10.8L4.43333 11.6333L2.53333 9.73332C2.22897 9.43259 1.98732 9.07444 1.82239 8.67963C1.65746 8.28482 1.57254 7.8612 1.57254 7.43332C1.57254 7.00545 1.65746 6.58183 1.82239 6.18702C1.98732 5.79221 2.22897 5.43405 2.53333 5.13332V5.13332Z" /> <path fill-rule="evenodd" clip-rule="evenodd" d="M11.8667 14.4667C12.4733 13.8549 12.8136 13.0282 12.8136 12.1667C12.8136 11.3051 12.4733 10.4785 11.8667 9.86666L9.96667 7.96666L9.13334 8.79999L11.0333 10.7C11.4223 11.089 11.6408 11.6166 11.6408 12.1667C11.6408 12.7168 11.4223 13.2443 11.0333 13.6333C10.6444 14.0223 10.1168 14.2408 9.56667 14.2408C9.01656 14.2408 8.48899 14.0223 8.1 13.6333L6.2 11.7333L5.36667 12.5667L7.26667 14.4667C7.87847 15.0733 8.70513 15.4136 9.56667 15.4136C10.4282 15.4136 11.2549 15.0733 11.8667 14.4667V14.4667Z" /> <path fill-rule="evenodd" clip-rule="evenodd" d="M9.13334 12.5667L4.43333 7.86667L5.26667 7.03334L9.96667 11.7333L9.13334 12.5667V12.5667Z" /></svg>
            </button>
            <div class="copy-clip-confirmation">
               <p>Copied!</p>
            </div>
         </li>
      
   </ul>
   
</div>

</div>
        </div>
      </div>
    </article>
  </div>
</main>




  
  
    
      
    
  
    
  
  
  


  
   
      
  <footer class="bt-section footer bg-navy white">
    <div class="bt-container">
      <div id="hs_cos_wrapper_module_16267052898241" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module">

  
    
    
      
    
  
      
    
      
      
                    
          
                    
          
                    
          
                    
          
                    
          
                    
          
        
      
      
      
    
  
      
    
  
      
    
  
      
    
  
      
    
  
      
    
  
      
    
  
      
    
      
      
                    
          
                    
          
                    
          
                    
          
                    
          
                    
          
        
      
      
      
    
  
      
    
  
      
    
  
      
    
  
      
    
  
      
    
  
      
    
  
      
    
      
      
                    
          
                    
          
                    
          
                    
          
                    
          
                    
          
        
      
      
      
    
  
      
    
  
      
    
  
      
    
  
      
    
  
      
    
  
      
    
  
      
    
      
      
                    
          
                    
          
                    
          
                    
          
                    
          
                    
          
                    
          
        
      
      
      
    
  
      
    
  
      
    
  
      
    
  
      
    
  
      
    
  
      
    
  
      
    
  
      
    
      
      
                    
          
                    
          
                    
          
                    
          
                    
          
                    
          
                    
          
                    
          
        
      
      
      
    
  
      
    
  
      
    
  
      
    
  
      
    
  
      
    
  
      
    
  
      
    
  
      
    
  


  <div class="footer-main-columns u-flex u-flexJustifyBetween">
    <div class="footer-logo-wrapper">
      <svg viewbox="0 0 91 74" width="35" height="29" xmlns="http://www.w3.org/2000/svg" fill="none">
        <title>Betterment Logo Icon SVG Footer</title>
        <path d="M45.2571 60.0478C53.6288 63.0794 68.2782 68.3853 81.1967 73.0658C87.083 65.4792 90.5143 55.8131 90.5143 45.0369C90.5143 19.3603 71.0593 0 45.2571 0C19.4571 0 0 19.3603 0 45.0369C0 55.8153 3.42913 65.4792 9.31758 73.0658C22.26 68.3788 36.9311 63.0643 45.2571 60.0478Z" fill="#FFC729" />
      </svg>
    </div>
  
    
    <nav class="footer-menu-wrapper" aria-label="footer navigation">
      <ul>
      
        <li class="footer-menu_column footer-menu_column-0">
          
            <div class="footer-menu-title">Accounts</div>
          

          
          <ul>
          
            <li>
              <a class="footer__menu__item" href="../investing.html" target="" data-track-event="ElementClicked" data-track-name="Investing" data-track-module="Footer" data-interaction-listener-registered="true">Investing</a>
            </li>
            
            <li>
              <a class="footer__menu__item" href="../ira-and-401k.html" target="" data-track-event="ElementClicked" data-track-name="IRAs and 401(k)s" data-track-module="Footer" data-interaction-listener-registered="true">IRAs and 401(k)s</a>
            </li>
            
            <li>
              <a class="footer__menu__item" href="../roth-ira.html" target="" data-track-event="ElementClicked" data-track-name="Roth IRAs" data-track-module="Footer" data-interaction-listener-registered="true">Roth IRAs</a>
            </li>
            
            <li>
              <a class="footer__menu__item" href="../cash-reserve.html" target="" data-track-event="ElementClicked" data-track-name="Cash Reserve" data-track-module="Footer" data-interaction-listener-registered="true">Cash Reserve</a>
            </li>
            
            <li>
              <a class="footer__menu__item" href="../checking.html" target="" data-track-event="ElementClicked" data-track-name="Checking" data-track-module="Footer" data-interaction-listener-registered="true">Checking</a>
            </li>
            
            <li>
              <a class="footer__menu__item" href="../trust-accounts.html" target="" data-track-event="ElementClicked" data-track-name="Trusts" data-track-module="Footer" data-interaction-listener-registered="true">Trusts</a>
            </li>
            
          </ul>
          
        </li>
      
        <li class="footer-menu_column footer-menu_column-1">
          
            <div class="footer-menu-title">Investments</div>
          

          
          <ul>
          
            <li>
              <a class="footer__menu__item" href="../investments.html" target="" data-track-event="ElementClicked" data-track-name="Portfolio options" data-track-module="Footer" data-interaction-listener-registered="true">Portfolio options</a>
            </li>
            
            <li>
              <a class="footer__menu__item" href="../socially-responsible-investing.html" target="" data-track-event="ElementClicked" data-track-name="Socially responsible investing" data-track-module="Footer" data-interaction-listener-registered="true">Socially responsible investing</a>
            </li>
            
            <li>
              <a class="footer__menu__item" href="../tax-efficient-investing.html" target="" data-track-event="ElementClicked" data-track-name="Tax-smart investing" data-track-module="Footer" data-interaction-listener-registered="true">Tax-smart investing</a>
            </li>
            
            <li>
              <a class="footer__menu__item" href="../charitable-giving/index.html" target="" data-track-event="ElementClicked" data-track-name="Charitable giving" data-track-module="Footer" data-interaction-listener-registered="true">Charitable giving</a>
            </li>
            
            <li>
              <a class="footer__menu__item" href="../rollover.html" target="" data-track-event="ElementClicked" data-track-name="401(k) rollovers" data-track-module="Footer" data-interaction-listener-registered="true">401(k) rollovers</a>
            </li>
            
            <li>
              <a class="footer__menu__item" href="../retirement-income.html" target="" data-track-event="ElementClicked" data-track-name="Retirement income" data-track-module="Footer" data-interaction-listener-registered="true">Retirement income</a>
            </li>
            
          </ul>
          
        </li>
      
        <li class="footer-menu_column footer-menu_column-2">
          
            <div class="footer-menu-title">Tools</div>
          

          
          <ul>
          
            <li>
              <a class="footer__menu__item" href="../retirement.html" target="" data-track-event="ElementClicked" data-track-name="Retirement planning" data-track-module="Footer" data-interaction-listener-registered="true">Retirement planning</a>
            </li>
            
            <li>
              <a class="footer__menu__item" href="../goals.html" target="" data-track-event="ElementClicked" data-track-name="Track your goals" data-track-module="Footer" data-interaction-listener-registered="true">Track your goals</a>
            </li>
            
            <li>
              <a class="footer__menu__item" href="../dashboard.html" target="" data-track-event="ElementClicked" data-track-name="All-in-one dashboard" data-track-module="Footer" data-interaction-listener-registered="true">All-in-one dashboard</a>
            </li>
            
            <li>
              <a class="footer__menu__item" href="../robo-advisor.html" target="" data-track-event="ElementClicked" data-track-name="Compare robo-advisors" data-track-module="Footer" data-interaction-listener-registered="true">Compare robo-advisors</a>
            </li>
            
            <li>
              <a class="footer__menu__item" href="../rewards.html" target="" data-track-event="ElementClicked" data-track-name="Rewards" data-track-module="Footer" data-interaction-listener-registered="true">Rewards</a>
            </li>
            
            <li>
              <a class="footer__menu__item" href="../referral.html" target="" data-track-event="ElementClicked" data-track-name="Refer-a-friend program" data-track-module="Footer" data-interaction-listener-registered="true">Refer-a-friend program</a>
            </li>
            
          </ul>
          
        </li>
      
        <li class="footer-menu_column footer-menu_column-3">
          
            <div class="footer-menu-title">Help</div>
          

          
          <ul>
          
            <li>
              <a class="footer__menu__item" href="../help.html" target="" data-track-event="ElementClicked" data-track-name="Help center" data-track-module="Footer" data-interaction-listener-registered="true">Help center</a>
            </li>
            
            <li>
              <a class="footer__menu__item" href="../help/tag/common-questions.html" target="" data-track-event="ElementClicked" data-track-name="FAQ" data-track-module="Footer" data-interaction-listener-registered="true">FAQ</a>
            </li>
            
            <li>
              <a class="footer__menu__item" href="../financial-experts.html" target="" data-track-event="ElementClicked" data-track-name="Expert guidance" data-track-module="Footer" data-interaction-listener-registered="true">Expert guidance</a>
            </li>
            
            <li>
              <a class="footer__menu__item" href="../resources/how-robo-advisors-guide-your-investing.html" target="" data-track-event="ElementClicked" data-track-name="Investment philosophy" data-track-module="Footer" data-interaction-listener-registered="true">Investment philosophy</a>
            </li>
            
            <li>
              <a class="footer__menu__item" href="../resources.html" target="" data-track-event="ElementClicked" data-track-name="Article library" data-track-module="Footer" data-interaction-listener-registered="true">Article library</a>
            </li>
            
            <li>
              <a class="footer__menu__item" href="../resources/video.html" target="" data-track-event="ElementClicked" data-track-name="Video" data-track-module="Footer" data-interaction-listener-registered="true">Video</a>
            </li>
            
            <li>
              <a class="footer__menu__item" href="../legal.html" target="" data-track-event="ElementClicked" data-track-name="Legal" data-track-module="Footer" data-interaction-listener-registered="true">Legal</a>
            </li>
            
          </ul>
          
        </li>
      
        <li class="footer-menu_column footer-menu_column-4">
          
            <div class="footer-menu-title">Company</div>
          

          
          <ul>
          
            <li>
              <a class="footer__menu__item" href="../pricing.html" target="" data-track-event="ElementClicked" data-track-name="Pricing" data-track-module="Footer" data-interaction-listener-registered="true">Pricing</a>
            </li>
            
            <li>
              <a class="footer__menu__item" href="../about.html" target="" data-track-event="ElementClicked" data-track-name="About us" data-track-module="Footer" data-interaction-listener-registered="true">About us</a>
            </li>
            
            <li>
              <a class="footer__menu__item" href="../mobile-app.html" target="" data-track-event="ElementClicked" data-track-name="Mobile app" data-track-module="Footer" data-interaction-listener-registered="true">Mobile app</a>
            </li>
            
            <li>
              <a class="footer__menu__item" href="../how-it-works.html" target="" data-track-event="ElementClicked" data-track-name="How Betterment works" data-track-module="Footer" data-interaction-listener-registered="true">How Betterment works</a>
            </li>
            
            <li>
              <a class="footer__menu__item" href="../roadmap.html" target="" data-track-event="ElementClicked" data-track-name="Product roadmap" data-track-module="Footer" data-interaction-listener-registered="true">Product roadmap</a>
            </li>
            
            <li>
              <a class="footer__menu__item" href="../press.html" target="" data-track-event="ElementClicked" data-track-name="Press" data-track-module="Footer" data-interaction-listener-registered="true">Press</a>
            </li>
            
            <li>
              <a class="footer__menu__item" href="https://shop.betterment.com/" target="" data-track-event="ElementClicked" data-track-name="Betterment shop" data-track-module="Footer" data-interaction-listener-registered="true">Betterment shop</a>
            </li>
            
            <li>
              <a class="footer__menu__item" href="../careers.html" target="" data-track-event="ElementClicked" data-track-name="Careers" data-track-module="Footer" data-interaction-listener-registered="true">Careers</a>
            </li>
            
          </ul>
          
        </li>
      
      </ul>
    </nav>
    
  </div>

  <div class="footer-bottom-menu">
    <div class="footer-social-icons">
      <ul class="flex">
        <li>
          <a href="https://www.instagram.com/betterment/" target="_blank" rel="noopener noreferrer"><svg aria-label="Betterment on Instagram" width="24" height="24" viewbox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"> <title>Betterment on Instagram</title> <path d="M12 2.163C15.204 2.163 15.584 2.175 16.85 2.233C20.102 2.381 21.621 3.924 21.769 7.152C21.827 8.417 21.838 8.797 21.838 12.001C21.838 15.206 21.826 15.585 21.769 16.85C21.62 20.075 20.105 21.621 16.85 21.769C15.584 21.827 15.206 21.839 12 21.839C8.796 21.839 8.416 21.827 7.151 21.769C3.891 21.62 2.38 20.07 2.232 16.849C2.174 15.584 2.162 15.205 2.162 12C2.162 8.796 2.175 8.417 2.232 7.151C2.381 3.924 3.896 2.38 7.151 2.232C8.417 2.175 8.796 2.163 12 2.163ZM12 0C8.741 0 8.333 0.014 7.053 0.072C2.695 0.272 0.273 2.69 0.073 7.052C0.014 8.333 0 8.741 0 12C0 15.259 0.014 15.668 0.072 16.948C0.272 21.306 2.69 23.728 7.052 23.928C8.333 23.986 8.741 24 12 24C15.259 24 15.668 23.986 16.948 23.928C21.302 23.728 23.73 21.31 23.927 16.948C23.986 15.668 24 15.259 24 12C24 8.741 23.986 8.333 23.928 7.053C23.732 2.699 21.311 0.273 16.949 0.073C15.668 0.014 15.259 0 12 0V0ZM12 5.838C8.597 5.838 5.838 8.597 5.838 12C5.838 15.403 8.597 18.163 12 18.163C15.403 18.163 18.162 15.404 18.162 12C18.162 8.597 15.403 5.838 12 5.838ZM12 16C9.791 16 8 14.21 8 12C8 9.791 9.791 8 12 8C14.209 8 16 9.791 16 12C16 14.21 14.209 16 12 16ZM18.406 4.155C17.61 4.155 16.965 4.8 16.965 5.595C16.965 6.39 17.61 7.035 18.406 7.035C19.201 7.035 19.845 6.39 19.845 5.595C19.845 4.8 19.201 4.155 18.406 4.155Z" fill="currentColor"></path> </svg></a>
        </li>
        <li>
          <a href="http://facebook.com/betterment" target="_blank" rel="noopener noreferrer"><svg fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 16 16" aria-label="Betterment on Facebook" role="img"><title>Betterment on Facebook</title><path d="M9.5 3H12V0H9.5C7.5 0 6 1.6 6 3.5V5H4v3h2v8h3V8h2.5l.5-3H9V3.5c0-.3.2-.5.5-.5"></path></svg></a>
        </li>
        <li>
          <a href="http://twitter.com/betterment" target="_blank" rel="noopener noreferrer"><svg fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 16 16" aria-label="Betterment on Twitter" role="img"> <title>Betterment on Twitter</title> <path d="M16 2.7c-.6.3-1.2.5-1.9.5.7-.4 1.2-1 1.5-1.8a6 6 0 01-2.1.8 3.3 3.3 0 00-5.6 3A9.3 9.3 0 011 1.8a3.3 3.3 0 001 4.4c-.5 0-1-.2-1.5-.4 0 1.6 1.2 3 2.7 3.2a3.3 3.3 0 01-1.5 0 3.3 3.3 0 003 2.4A6.6 6.6 0 010 12.7a9.3 9.3 0 0014.4-8.3c.6-.4 1.2-1 1.6-1.7"></path> </svg></a>
        </li>
        <li>
          <a href="http://www.linkedin.com/company/betterment" target="_blank" rel="noopener noreferrer"><svg fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 16 16" aria-label="Betterment on LinkedIn" role="img"> <title>Betterment on LinkedIn</title> <path d="M.2 15.2h3.4V4.9H.2v10.3zM1.9 0C.8 0 0 .8 0 1.8s.7 1.8 1.9 1.8 2-.8 2-1.8S3 0 1.9 0zM16 9.3v5.9h-3.4V9.7c0-1.4-.5-2.3-1.8-2.3-1 0-1.5.6-1.7 1.2l-.1.9v5.7H5.5V4.9H9v1.5c.4-.7 1.2-1.7 3-1.7 2.3 0 4 1.5 4 4.6z"></path> </svg></a>
        </li>
      </ul>
    </div>

    
      <div class="footer-apps-icons">
        <ul class="flex">
          
            <li>
              <a class="track-ios-click" href="https://apps.apple.com/us/app/betterment-money-management/id393156562" target="_blank" rel="noopener noreferrer" data-behavior-app-store-link="" data-cy-apple-store-link="" data-appsflyer-source="retailBrochureFooter" data-track-event="AppStoreSelected" data-track-name="DownloadIOSAppStore" data-track-module="Footer">
                <img class="lazy" data-src="https://www.betterment.com/hubfs/Graphics/shared-assets/app-store-badge_wht-bdr.svg" alt="apple-app-store">
              </a>
            </li>
          
          
            <li>
              <a class="track-google-play-click" href="https://play.google.com/store/apps/details?id=com.betterment" target="_blank" rel="noopener noreferrer" data-behavior-app-store-link="" data-cy-android-store-link="" data-android-store-link data-appsflyer-source="retailBrochureFooter" data-track-event="AppStoreSelected" data-track-name="DownloadGooglePlay" data-track-module="Footer">
                <img class="lazy" data-src="https://www.betterment.com/hubfs/Graphics/shared-assets/google-play-badge-wht-bdr.svg" alt="google-play-store">
              </a>
            </li>
        
        </ul>
      </div>
    


    
    <div class="footer-bottom-links">
    
      <ul class="flex">
        
          
            
            
            
            

          <li>
            <a href="../contact.html" data-track-event="ElementClicked" data-track-name="Contact us" data-track-module="Footer" data-interaction-listener-registered="true">Contact us</a>
          </li>
        
          
            
            
            
            

          <li>
            <a href="../work.html" data-track-event="ElementClicked" data-track-name="Betterment 401(k)" data-track-module="Footer" data-interaction-listener-registered="true">Betterment 401(k)</a>
          </li>
        
          
            
            
            
            

          <li>
            <a href="../advisors.html" data-track-event="ElementClicked" data-track-name="Betterment for Advisors" data-track-module="Footer" data-interaction-listener-registered="true">Betterment for Advisors</a>
          </li>
        
      </ul>
    
    </div>


  </div>

</div>

      <div id="hs_cos_wrapper_module_16301570831873" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module"> 

 
  

  
  
  
  
    
      
    
  
    
  
    
  
    
  
    
  
    
  
    
  
  
  <div class="footer-disclosure-wrap">
    
  
  
    
   
    
      <div class="footer-disclosure-rows entity-disclosure"><p>This page is operated and maintained by Betterment Holdings Inc. and it is not associated with Betterment LLC or MTG LLC. © 2021 Betterment Holdings Inc.</p></div>
    
  
    <div class="footer-disclosure-rows">
      
  
<div>
  <p> You are viewing a web property located at Betterment.com. Different properties may be provided by a different entity with different marketing standards. </p>
  
  
  <ul class="flex-wrap list-links">
    
    <li>
      <a href="../sitemap.html">Site Map</a>
    </li>
  
    
    <li>
      <a href="../legal/terms.html">Terms of Use</a>
    </li>
  
    
    <li>
      <a href="../legal/privacy-policy.html">Privacy Policy</a>
    </li>
  
    
    <li>
      <a href="../legal/copyright-intellectual-property.html">Trademark</a>
    </li>
  
    
    <li>
      <a href="../legal.html">Legal Directory</a>
    </li>
  
  </ul>

  <p>Google Play and the Google Play logo are trademarks of Google, Inc.</p>
  <p>Apple, the Apple logo, and iPhone are trademarks of Apple, Inc., registered in the U.S.</p>
  <p>Any links provided to other websites are offered as a matter of convenience and are not intended to imply that Betterment or its authors endorse, sponsor, promote, and/or are affiliated with the owners of or participants in those sites, unless stated otherwise.</p>
  <p>© Betterment. All rights reserved</p>
</div>


    </div>
  </div></div> 
    </div> 
  </footer>  

    </div>
    
    
    
    
    
<script>
(function () {
    window.addEventListener('load', function () {
        setTimeout(function () {
            var xhr = new XMLHttpRequest();
            xhr.open('POST.html', '/_hcms/perf', true /*async*/);
            xhr.setRequestHeader("Content-type", "application/json");
            xhr.onreadystatechange = function () {
                // do nothing.
            };
            var connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
            function populateNetworkInfo(name, connection, info) {
                if (name in connection) {
                    info[name] = connection[name];
                }
            }
            var networkInfo = {};
            if (connection) {
                ['type', 'effectiveType', 'downlink', 'rtt'].forEach(function(name) {
                    populateNetworkInfo(name, connection, networkInfo);
                });
            }
            var perfData = {
                url: location.href,
                portal: 5274572,
                content: 57406541360,
                group: -1,
                connection: networkInfo,
                timing: performance.timing
            };
            xhr.send(JSON.stringify(perfData));
        }, 3000);  // Execute this 3 seconds after onload.
    });
})();
</script>

<script src="../../cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="../../cdnjs.cloudflare.com/ajax/libs/jquery-migrate/3.3.1/jquery-migrate.min.js"></script>

      <script id="__ada" data-handle="betterment-cx" src="../../static.ada.support/embed2.js" data-lazy=""></script>
    
<script src="../hs-fs/hub/5274572/hub_generated/template_assets/57001203564/1664461384184/betterment-theme/resources/btTrackingInit.min.js"></script>
<script src="../hs-fs/hub/5274572/hub_generated/template_assets/49666399874/1664461384009/betterment-theme/js/main.min.js"></script>
<script>
var hsVars = hsVars || {}; hsVars['language'] = 'en';
</script>

<script src="../hs/hsstatic/cos-i18n/static-1.53/bundles/project.js"></script>
<script src="../hs-fs/hub/5274572/hub_generated/template_assets/54140855575/1646258612663/betterment-theme/js/custom-scripts/navigation.min.js"></script>
<script src="../hs-fs/hub/5274572/hub_generated/module_assets/64614019605/1664467640221/module_64614019605_toast_banner_global.min.js"></script>


<script>
   $(".copy-clip-container").click(function() {
      let clipContainer = $(this);
      $(clipContainer).find('.copy-clip-confirmation').removeClass('copy-clip-confirmation--animate');
      navigator.clipboard.writeText('how-we-engineered-tax-coordinated-portfolio.html').then(
      function() 
         { 
            $(clipContainer).find('.copy-clip-confirmation').addClass('copy-clip-confirmation--animate');
         }
      );
   });

</script>

<script src="../hs-fs/hub/5274572/hub_generated/template_assets/57077355813/1659471603755/betterment-theme/templates/engineering_blog/blog.min.js"></script>

<!-- Start of HubSpot Analytics Code -->
<script type="text/javascript">
var _hsq = _hsq || [];
_hsq.push(["setContentType", "blog-post"]);
_hsq.push(["setCanonicalUrl", "https:\/\/www.betterment.com\/engineering\/how-we-engineered-tax-coordinated-portfolio"]);
_hsq.push(["setPageId", "57406541360"]);
_hsq.push(["setContentMetadata", {
    "contentPageId": 57406541360,
    "legacyPageId": "57406541360",
    "contentFolderId": null,
    "contentGroupId": 57138234906,
    "abTestId": null,
    "languageVariantId": 57406541360,
    "languageCode": "en",
    
}]);
</script>

<script type="text/javascript" id="hs-script-loader" async defer src="../hs/scriptloader/5274572.js"></script>
<!-- End of HubSpot Analytics Code -->


<script type="text/javascript">
var hsVars = {
    ticks: 1664470793159,
    page_id: 57406541360,
    
    content_group_id: 57138234906,
    portal_id: 5274572,
    app_hs_base_url: "https://app.hubspot.com",
    cp_hs_base_url: "https://cp.hubspot.com",
    language: "en",
    analytics_page_type: "blog-post",
    analytics_page_id: "57406541360",
    category_id: 3,
    folder_id: 0,
    is_hubspot_user: false
}
</script>


<script defer src="../hs/hsstatic/HubspotToolsMenu/static-1.138/js/index.js"></script>



<div id="fb-root"></div>
 <script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "../../connect.facebook.net/en_GB/all.js#xfbml=1&status=0";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
 <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="../../platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
 


  
</body>
<!-- Mirrored from www.betterment.com/engineering/how-we-engineered-tax-coordinated-portfolio by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 30 Sep 2022 12:45:23 GMT -->
</html>